# SentinXFL - System Architecture

> **Version**: 2.0  
> **Last Updated**: February 5, 2026  
> **Author**: Anshuman Bakshi (RA2211033010117)  

---

## 1. High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SentinXFL SYSTEM ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        PRESENTATION LAYER                           │    │
│  │                     (Next.js 14 + shadcn/ui)                        │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │    │
│  │  │Dashboard │ │Local Bank│ │ Central  │ │Technical │ │  Export  │  │    │
│  │  │ Overview │ │   View   │ │Knowledge │ │ Appendix │ │  Reports │  │    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                           API LAYER                                 │    │
│  │                         (FastAPI REST)                              │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │    │
│  │  │  /data   │ │ /models  │ │   /fl    │ │ /reports │ │ /metrics │  │    │
│  │  │ endpoints│ │ endpoints│ │ endpoints│ │ endpoints│ │ endpoints│  │    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         SERVICE LAYER                               │    │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │    │
│  │  │  Data Service │  │ Model Service │  │   FL Service  │           │    │
│  │  │  • Loader     │  │  • Training   │  │  • Server     │           │    │
│  │  │  • Splitter   │  │  • Inference  │  │  • Client     │           │    │
│  │  │  • Validator  │  │  • Ensemble   │  │  • Simulator  │           │    │
│  │  └───────────────┘  └───────────────┘  └───────────────┘           │    │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │    │
│  │  │  PII Service  │  │  DP Service   │  │  LLM Service  │           │    │
│  │  │  • Detector   │  │  • Accountant │  │  • Generator  │           │    │
│  │  │  • Blocker    │  │  • Mechanisms │  │  • RAG        │           │    │
│  │  │  • Certifier  │  │  • Budget     │  │  • Guards     │           │    │
│  │  └───────────────┘  └───────────────┘  └───────────────┘           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        STORAGE LAYER                                │    │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │    │
│  │  │    DuckDB     │  │   ChromaDB    │  │  File System  │           │    │
│  │  │ (Analytics)   │  │  (Vectors)    │  │   (Models)    │           │    │
│  │  └───────────────┘  └───────────────┘  └───────────────┘           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. PII Blocking Pipeline (Patent Core)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              CERTIFIED DATA SANITIZATION PIPELINE (PATENT CORE)             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  RAW DATA INPUT                                                             │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  GATE 1: SCHEMA VALIDATION                                          │    │
│  │  ══════════════════════════════════════════════════════════════════ │    │
│  │  • Whitelist allowed columns only                                   │    │
│  │  • Reject unknown columns (potential PII injection)                 │    │
│  │  • Type validation (string columns = suspicious)                    │    │
│  │  • Required fields check                                            │    │
│  │                                                                     │    │
│  │  PASS → Continue    FAIL → HARD BLOCK (no data access)             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │ ✅                                                                  │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  GATE 2: STATISTICAL PII DETECTION                                  │    │
│  │  ══════════════════════════════════════════════════════════════════ │    │
│  │  For each column, compute:                                          │    │
│  │                                                                     │    │
│  │  • Entropy: H(X) = -Σ p(x) log p(x)                                 │    │
│  │    High entropy (> 4.0) + high cardinality = potential PII          │    │
│  │                                                                     │    │
│  │  • Cardinality ratio: unique_values / total_rows                    │    │
│  │    Ratio > 0.9 = likely identifier                                  │    │
│  │                                                                     │    │
│  │  • Pattern detection: regex for CC#, SSN, email, phone              │    │
│  │    Any match = flag as PII                                          │    │
│  │                                                                     │    │
│  │  PASS → Continue    FAIL → HARD BLOCK or TRANSFORM                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │ ✅                                                                  │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  GATE 3: QUASI-IDENTIFIER ANALYSIS                                  │    │
│  │  ══════════════════════════════════════════════════════════════════ │    │
│  │  Quasi-identifiers: columns that combined can identify individuals  │    │
│  │  Example: age + zip + gender + income → unique person               │    │
│  │                                                                     │    │
│  │  k-Anonymity Check:                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────────┐    │    │
│  │  │  For quasi-identifier combination Q = {q1, q2, ..., qn}:    │    │    │
│  │  │  Count rows with identical Q values                         │    │    │
│  │  │  If any group has count < k (default k=5):                  │    │    │
│  │  │    → Re-identification risk detected                        │    │    │
│  │  │    → BLOCK or GENERALIZE                                    │    │    │
│  │  └─────────────────────────────────────────────────────────────┘    │    │
│  │                                                                     │    │
│  │  PASS → Continue    FAIL → TRANSFORM or SUPPRESS                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │ ✅                                                                  │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  GATE 4: SAFE TRANSFORMATIONS                                       │    │
│  │  ══════════════════════════════════════════════════════════════════ │    │
│  │                                                                     │    │
│  │  Transformation Methods:                                            │    │
│  │  ┌─────────────────────────────────────────────────────────────┐    │    │
│  │  │ BINNING:        age → age_band (18-25, 26-35, 36-45, ...)   │    │    │
│  │  │                 income → income_band (0-25k, 25k-50k, ...)  │    │    │
│  │  ├─────────────────────────────────────────────────────────────┤    │    │
│  │  │ GENERALIZATION: city → state → region → country             │    │    │
│  │  │                 timestamp → hour → day → week               │    │    │
│  │  ├─────────────────────────────────────────────────────────────┤    │    │
│  │  │ SUPPRESSION:    Remove column entirely if too risky         │    │    │
│  │  │                 (e.g., name_email_similarity)               │    │    │
│  │  ├─────────────────────────────────────────────────────────────┤    │    │
│  │  │ DP NOISE:       Add calibrated Laplace/Gaussian noise       │    │    │
│  │  │                 Noise ~ Laplace(Δf/ε) or N(0, σ²)           │    │    │
│  │  └─────────────────────────────────────────────────────────────┘    │    │
│  │                                                                     │    │
│  │  Output: Transformed data with utility preserved                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │ ✅                                                                  │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  GATE 5: CERTIFICATION                                              │    │
│  │  ══════════════════════════════════════════════════════════════════ │    │
│  │                                                                     │    │
│  │  Final Checks:                                                      │    │
│  │  • Re-identification risk score < 5%                                │    │
│  │  • All PII columns removed/transformed                              │    │
│  │  • k-anonymity verified (k ≥ 5)                                     │    │
│  │                                                                     │    │
│  │  Certificate Generation:                                            │    │
│  │  ┌─────────────────────────────────────────────────────────────┐    │    │
│  │  │ {                                                           │    │    │
│  │  │   "certificate_id": "CERT-20260205-abc123",                 │    │    │
│  │  │   "timestamp": "2026-02-05T10:30:00Z",                      │    │    │
│  │  │   "schema_hash": "sha256:...",                              │    │    │
│  │  │   "k_anonymity": 5,                                         │    │    │
│  │  │   "reidentification_risk": 0.023,                           │    │    │
│  │  │   "transformations_applied": [...],                         │    │    │
│  │  │   "columns_blocked": [...],                                 │    │    │
│  │  │   "status": "CERTIFIED_SAFE"                                │    │    │
│  │  │ }                                                           │    │    │
│  │  └─────────────────────────────────────────────────────────────┘    │    │
│  │                                                                     │    │
│  │  Audit Log Entry (append-only, hash-chained):                      │    │
│  │  prev_hash → current_entry → hash → next_entry                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │ ✅ CERTIFIED                                                       │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  ML MODELS (Only receives certified data)                          │    │
│  │  • XGBoost, LightGBM, IsolationForest, TabNet                      │    │
│  │  • NO raw PII ever reaches this layer                              │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Federated Learning Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    FEDERATED LEARNING ARCHITECTURE                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                         ┌─────────────────────┐                             │
│                         │   FL COORDINATOR    │                             │
│                         │   (Flower Server)   │                             │
│                         │                     │                             │
│                         │  • Round Manager    │                             │
│                         │  • Aggregator       │                             │
│                         │  • DP Accountant    │                             │
│                         │  • Model Store      │                             │
│                         └─────────┬───────────┘                             │
│                                   │                                         │
│              ┌────────────────────┼────────────────────┐                    │
│              │                    │                    │                    │
│              ▼                    ▼                    ▼                    │
│  ┌───────────────────┐ ┌───────────────────┐ ┌───────────────────┐         │
│  │    BANK A NODE    │ │    BANK B NODE    │ │    BANK C NODE    │         │
│  │  (Flower Client)  │ │  (Flower Client)  │ │  (Flower Client)  │         │
│  │                   │ │                   │ │                   │         │
│  │ ┌───────────────┐ │ │ ┌───────────────┐ │ │ ┌───────────────┐ │         │
│  │ │   Local Data  │ │ │ │   Local Data  │ │ │ │   Local Data  │ │         │
│  │ │   (Private)   │ │ │ │   (Private)   │ │ │ │   (Private)   │ │         │
│  │ └───────────────┘ │ │ └───────────────┘ │ │ └───────────────┘ │         │
│  │        ↓          │ │        ↓          │ │        ↓          │         │
│  │ ┌───────────────┐ │ │ ┌───────────────┐ │ │ ┌───────────────┐ │         │
│  │ │ PII Blocking  │ │ │ │ PII Blocking  │ │ │ │ PII Blocking  │ │         │
│  │ │   Pipeline    │ │ │ │   Pipeline    │ │ │ │   Pipeline    │ │         │
│  │ └───────────────┘ │ │ └───────────────┘ │ │ └───────────────┘ │         │
│  │        ↓          │ │        ↓          │ │        ↓          │         │
│  │ ┌───────────────┐ │ │ ┌───────────────┐ │ │ ┌───────────────┐ │         │
│  │ │ Local Model   │ │ │ │ Local Model   │ │ │ │ Local Model   │ │         │
│  │ │   Training    │ │ │ │   Training    │ │ │ │   Training    │ │         │
│  │ └───────────────┘ │ │ └───────────────┘ │ │ └───────────────┘ │         │
│  │        ↓          │ │        ↓          │ │        ↓          │         │
│  │ ┌───────────────┐ │ │ ┌───────────────┐ │ │ ┌───────────────┐ │         │
│  │ │  DP Gradient  │ │ │ │  DP Gradient  │ │ │ │  DP Gradient  │ │         │
│  │ │   Clipping    │ │ │ │   Clipping    │ │ │ │   Clipping    │ │         │
│  │ │   + Noise     │ │ │ │   + Noise     │ │ │ │   + Noise     │ │         │
│  │ └───────┬───────┘ │ │ └───────┬───────┘ │ │ └───────┬───────┘ │         │
│  └─────────┼─────────┘ └─────────┼─────────┘ └─────────┼─────────┘         │
│            │                     │                     │                    │
│            └─────────────────────┼─────────────────────┘                    │
│                                  │                                          │
│                                  ▼                                          │
│                    ┌─────────────────────────┐                              │
│                    │   AGGREGATION LAYER     │                              │
│                    │                         │                              │
│                    │  ┌───────────────────┐  │                              │
│                    │  │     FedAvg        │  │  ← Default                   │
│                    │  │  w = Σ(nᵢ·wᵢ)/N   │  │                              │
│                    │  └───────────────────┘  │                              │
│                    │                         │                              │
│                    │  ┌───────────────────┐  │                              │
│                    │  │    Multi-Krum     │  │  ← Byzantine-robust         │
│                    │  │  Select k closest │  │                              │
│                    │  │  to cluster center│  │                              │
│                    │  └───────────────────┘  │                              │
│                    │                         │                              │
│                    │  ┌───────────────────┐  │                              │
│                    │  │   Trimmed Mean    │  │  ← Remove outliers          │
│                    │  │  Remove top/bot β │  │                              │
│                    │  └───────────────────┘  │                              │
│                    │                         │                              │
│                    │  ┌───────────────────┐  │                              │
│                    │  │ Coordinate Median │  │  ← Most robust              │
│                    │  │  median per coord │  │                              │
│                    │  └───────────────────┘  │                              │
│                    └─────────────────────────┘                              │
│                                  │                                          │
│                                  ▼                                          │
│                    ┌─────────────────────────┐                              │
│                    │    GLOBAL MODEL         │                              │
│                    │  (Broadcast to nodes)   │                              │
│                    └─────────────────────────┘                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Differential Privacy Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    DIFFERENTIAL PRIVACY ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  PRIVACY BUDGET TRACKING (RDP Accountant)                                   │
│  ═══════════════════════════════════════                                    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                                                                     │    │
│  │   Total Budget: ε = 1.0, δ = 1e-5                                   │    │
│  │                                                                     │    │
│  │   ┌─────────────────────────────────────────────────────────────┐   │    │
│  │   │ Round 1: ε₁ = 0.05                                          │   │    │
│  │   │ Round 2: ε₂ = 0.05                                          │   │    │
│  │   │ Round 3: ε₃ = 0.05                                          │   │    │
│  │   │ ...                                                         │   │    │
│  │   │ Round N: εₙ = 0.05                                          │   │    │
│  │   │ ──────────────────────                                      │   │    │
│  │   │ Composed: ε_total = f(ε₁, ε₂, ..., εₙ) via RDP             │   │    │
│  │   └─────────────────────────────────────────────────────────────┘   │    │
│  │                                                                     │    │
│  │   RDP Composition:                                                  │    │
│  │   • Tighter than basic composition                                  │    │
│  │   • ε_RDP(α) = Σ εᵢ_RDP(α) for each round                          │    │
│  │   • Convert: (ε,δ)-DP from (α, ε_RDP(α))                           │    │
│  │                                                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  NOISE MECHANISMS                                                           │
│  ════════════════                                                           │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                                                                     │    │
│  │  GAUSSIAN MECHANISM (for gradients)                                 │    │
│  │  ────────────────────────────────────                               │    │
│  │  f(x) + N(0, σ²)                                                    │    │
│  │  where σ = Δf · √(2·ln(1.25/δ)) / ε                                │    │
│  │                                                                     │    │
│  │  Process:                                                           │    │
│  │  1. Clip gradients: g' = g · min(1, C/||g||₂)                      │    │
│  │  2. Add noise: g'' = g' + N(0, σ²·C²·I)                            │    │
│  │  3. Aggregate: G = Σ g''ᵢ / n                                       │    │
│  │                                                                     │    │
│  │  ┌─────────────────────────────────────────────────────────────┐   │    │
│  │  │  LAPLACE MECHANISM (for counts/statistics)                  │   │    │
│  │  │  ──────────────────────────────────────                     │   │    │
│  │  │  f(x) + Lap(Δf/ε)                                           │   │    │
│  │  │  where Lap(b) has PDF: p(x) = (1/2b)·exp(-|x|/b)           │   │    │
│  │  └─────────────────────────────────────────────────────────────┘   │    │
│  │                                                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  BUDGET ENFORCEMENT                                                         │
│  ══════════════════                                                         │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                                                                     │    │
│  │  if (ε_spent + ε_query) > ε_total:                                  │    │
│  │      REJECT query                                                   │    │
│  │      Log: "Budget exhausted"                                        │    │
│  │  else:                                                              │    │
│  │      EXECUTE query with DP                                          │    │
│  │      ε_spent += ε_query                                             │    │
│  │      Log: "Budget remaining: {ε_total - ε_spent}"                   │    │
│  │                                                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. LLM & Explainability Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    LLM & EXPLAINABILITY ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     EVIDENCE COLLECTION                             │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │    │
│  │  │    SHAP     │  │   TabNet    │  │  XGBoost    │                 │    │
│  │  │   Values    │  │  Attention  │  │  Decision   │                 │    │
│  │  │             │  │   Weights   │  │    Path     │                 │    │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                 │    │
│  │         └────────────────┼────────────────┘                        │    │
│  │                          ▼                                         │    │
│  │              ┌─────────────────────┐                               │    │
│  │              │  Evidence Package   │                               │    │
│  │              │  • Top 5 features   │                               │    │
│  │              │  • Contribution %   │                               │    │
│  │              │  • Decision rules   │                               │    │
│  │              └──────────┬──────────┘                               │    │
│  └─────────────────────────┼───────────────────────────────────────────┘    │
│                            ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        RAG PIPELINE                                 │    │
│  │                                                                     │    │
│  │  ┌─────────────────┐       ┌─────────────────┐                     │    │
│  │  │    ChromaDB     │       │   Embeddings    │                     │    │
│  │  │  Pattern Store  │◄──────│ (MiniLM-L6-v2)  │                     │    │
│  │  │                 │       │   ~80MB model   │                     │    │
│  │  │ • Fraud patterns│       └─────────────────┘                     │    │
│  │  │ • Case studies  │                                               │    │
│  │  │ • Regulations   │                                               │    │
│  │  └────────┬────────┘                                               │    │
│  │           │                                                        │    │
│  │           ▼                                                        │    │
│  │  ┌─────────────────────────────────────────────────────────────┐   │    │
│  │  │  Context Retrieval (Top-k relevant patterns)                │   │    │
│  │  │  • MMR for diversity                                        │   │    │
│  │  │  • Relevance threshold > 0.7                                │   │    │
│  │  └─────────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────┬───────────────────────────────────────────┘    │
│                            ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    LLM GENERATION                                   │    │
│  │                                                                     │    │
│  │  Model: Phi-3-mini-4k-instruct (4-bit quantized)                   │    │
│  │  VRAM: ~2GB                                                         │    │
│  │                                                                     │    │
│  │  ┌─────────────────────────────────────────────────────────────┐   │    │
│  │  │  PROMPT TEMPLATE                                            │   │    │
│  │  │  ──────────────────                                         │   │    │
│  │  │  You are a fraud analyst. Based on the following evidence:  │   │    │
│  │  │                                                             │   │    │
│  │  │  EVIDENCE:                                                  │   │    │
│  │  │  {evidence_package}                                         │   │    │
│  │  │                                                             │   │    │
│  │  │  SIMILAR PATTERNS:                                          │   │    │
│  │  │  {retrieved_context}                                        │   │    │
│  │  │                                                             │   │    │
│  │  │  Generate a fraud explanation. ONLY cite the evidence       │   │    │
│  │  │  provided. Do not make assumptions.                         │   │    │
│  │  └─────────────────────────────────────────────────────────────┘   │    │
│  │                                                                     │    │
│  └─────────────────────────┬───────────────────────────────────────────┘    │
│                            ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  HALLUCINATION GUARDS                               │    │
│  │                                                                     │    │
│  │  ┌─────────────────────────────────────────────────────────────┐   │    │
│  │  │  1. NLI Verification                                        │   │    │
│  │  │     For each claim in output:                               │   │    │
│  │  │       - Check entailment with evidence                      │   │    │
│  │  │       - Score: entailment > 0.8 required                    │   │    │
│  │  ├─────────────────────────────────────────────────────────────┤   │    │
│  │  │  2. Numeric Verification                                    │   │    │
│  │  │     - Extract numbers from output                           │   │    │
│  │  │     - Verify against source data                            │   │    │
│  │  │     - Flag mismatches                                       │   │    │
│  │  ├─────────────────────────────────────────────────────────────┤   │    │
│  │  │  3. Citation Check                                          │   │    │
│  │  │     - Every factual claim must cite evidence                │   │    │
│  │  │     - Uncited claims → flagged                              │   │    │
│  │  ├─────────────────────────────────────────────────────────────┤   │    │
│  │  │  4. Confidence Scoring                                      │   │    │
│  │  │     - Aggregate verification scores                         │   │    │
│  │  │     - confidence < 0.8 → REJECT output                      │   │    │
│  │  └─────────────────────────────────────────────────────────────┘   │    │
│  │                                                                     │    │
│  └─────────────────────────┬───────────────────────────────────────────┘    │
│                            ▼                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      OUTPUT REPORTS                                 │    │
│  │                                                                     │    │
│  │  ┌─────────────────────┐    ┌─────────────────────┐                │    │
│  │  │  EXECUTIVE REPORT   │    │   EVIDENCE REPORT   │                │    │
│  │  │  (Sanitized)        │    │   (Auditable)       │                │    │
│  │  │                     │    │                     │                │    │
│  │  │  • High-level       │    │  • Full evidence    │                │    │
│  │  │  • No raw data      │    │  • Citations        │                │    │
│  │  │  • Action items     │    │  • Confidence       │                │    │
│  │  │  • For stakeholders │    │  • For compliance   │                │    │
│  │  └─────────────────────┘    └─────────────────────┘                │    │
│  │                                                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA FLOW DIAGRAM                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────┐                                                                │
│  │ CSV     │                                                                │
│  │ Files   │                                                                │
│  └────┬────┘                                                                │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  1. DATA INGESTION                                                  │    │
│  │     • DuckDB lazy loading                                           │    │
│  │     • Schema validation                                             │    │
│  │     • Type coercion                                                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  2. PII BLOCKING (5 Gates)                                          │    │
│  │     • Statistical detection                                         │    │
│  │     • Quasi-identifier analysis                                     │    │
│  │     • Transformations                                               │    │
│  │     • Certification                                                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  3. FEATURE ENGINEERING                                             │    │
│  │     • Temporal features                                             │    │
│  │     • Aggregations                                                  │    │
│  │     • Encodings                                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  4. TRAIN/VAL/TEST SPLIT                                            │    │
│  │     • Temporal split (no leakage)                                   │    │
│  │     • Stratified by fraud label                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ├──────────────────────────────────────┐                              │
│       ▼                                      ▼                              │
│  ┌──────────────────┐              ┌──────────────────┐                     │
│  │  5A. LOCAL       │              │  5B. FEDERATED   │                     │
│  │      TRAINING    │              │      LEARNING    │                     │
│  │                  │              │                  │                     │
│  │  • XGBoost       │              │  • Flower Server │                     │
│  │  • LightGBM      │              │  • DP Gradients  │                     │
│  │  • IsolationForest│             │  • Aggregation   │                     │
│  │  • TabNet        │              │  • N Rounds      │                     │
│  └────────┬─────────┘              └────────┬─────────┘                     │
│           │                                 │                               │
│           └─────────────┬───────────────────┘                               │
│                         ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  6. ENSEMBLE                                                        │    │
│  │     • Weighted combination                                          │    │
│  │     • Learned weights                                               │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  7. EVALUATION                                                      │    │
│  │     • Metrics (AUC, Precision, Recall, F1)                          │    │
│  │     • SHAP explanations                                             │    │
│  │     • Drift detection                                               │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  8. REPORT GENERATION                                               │    │
│  │     • LLM + RAG                                                     │    │
│  │     • Hallucination guards                                          │    │
│  │     • Executive & Evidence reports                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│       │                                                                     │
│       ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  9. DASHBOARD                                                       │    │
│  │     • Real-time metrics                                             │    │
│  │     • Alerts                                                        │    │
│  │     • Export                                                        │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Component Interaction

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         COMPONENT INTERACTION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Frontend (Next.js)          Backend (FastAPI)          Storage            │
│   ═══════════════════         ═════════════════          ═══════            │
│                                                                             │
│   ┌─────────────┐             ┌─────────────┐                               │
│   │  Dashboard  │────REST────▶│   /api/     │                               │
│   │    Pages    │◀────JSON────│  endpoints  │                               │
│   └─────────────┘             └──────┬──────┘                               │
│                                      │                                      │
│                               ┌──────┴──────┐                               │
│                               ▼             ▼                               │
│                        ┌──────────┐  ┌──────────┐                           │
│                        │  Data    │  │  Model   │                           │
│                        │ Service  │  │ Service  │                           │
│                        └────┬─────┘  └────┬─────┘                           │
│                             │             │                                 │
│                             ▼             ▼                                 │
│                        ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│                        │  DuckDB  │  │  Model   │  │ ChromaDB │            │
│                        │   (SQL)  │  │  Files   │  │(Vectors) │            │
│                        └──────────┘  └──────────┘  └──────────┘            │
│                                                                             │
│   Communication Patterns:                                                   │
│   • Frontend ↔ Backend: REST API (JSON)                                    │
│   • Backend ↔ Storage: Direct file/DB access                               │
│   • FL Nodes ↔ Coordinator: Flower protocol (gRPC)                         │
│   • LLM: Local inference (no network)                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Deployment Architecture (Future)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    DEPLOYMENT ARCHITECTURE (HYBRID)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   CLOUD (Vercel + Fly.io)                                                   │
│   ════════════════════════                                                  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                         VERCEL                                      │   │
│   │   ┌───────────────────────────────────────────────────────────┐     │   │
│   │   │  Next.js Frontend (Static + SSR)                          │     │   │
│   │   │  • Dashboard pages                                        │     │   │
│   │   │  • API routes (proxy to backend)                          │     │   │
│   │   └───────────────────────────────────────────────────────────┘     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        FLY.IO / RAILWAY                             │   │
│   │   ┌───────────────────────────────────────────────────────────┐     │   │
│   │   │  FastAPI Backend + FL Coordinator                         │     │   │
│   │   │  • REST API                                               │     │   │
│   │   │  • Flower Server                                          │     │   │
│   │   │  • DP Accountant                                          │     │   │
│   │   └───────────────────────────────────────────────────────────┘     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│   ═══════════════════════════════════╪══════════════════════════════════   │
│                                      │                                      │
│   ON-PREMISE (Bank Infrastructure)   │                                      │
│   ═════════════════════════════════  │                                      │
│                                      ▼                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  BANK A                          BANK B                  BANK C     │   │
│   │  ┌───────────┐                  ┌───────────┐          ┌─────────┐  │   │
│   │  │ FL Client │                  │ FL Client │          │FL Client│  │   │
│   │  │ Local Data│                  │ Local Data│          │Local Dat│  │   │
│   │  │ PII Block │                  │ PII Block │          │PII Block│  │   │
│   │  └───────────┘                  └───────────┘          └─────────┘  │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   DATA FLOW:                                                                │
│   • Raw data: NEVER leaves bank premises                                    │
│   • Noised gradients: Sent to coordinator (cloud)                           │
│   • Aggregated model: Broadcast back to banks                               │
│   • Dashboard data: Aggregated metrics only                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

*Document Version: 2.0 | Author: Anshuman Bakshi | Date: February 5, 2026*
